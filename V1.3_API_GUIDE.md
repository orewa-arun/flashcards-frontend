# v1.3 Content Pipeline API Guide

## Base URL
```
http://localhost:8000/api/v1/content
```

## Endpoints

### 1. Ingest Course and Lectures

**POST** `/ingest`

Upload course metadata and lecture PDFs.

**Request**: `multipart/form-data`

```bash
curl -X POST "http://localhost:8000/api/v1/content/ingest" \
  -F "course_code=MAPP_F_MKT404_EN_2025" \
  -F "course_name=Customer experience and branding" \
  -F "instructor=Professor Jean-Christophe Pineau" \
  -F "additional_info=Groups 5-11-15" \
  -F 'reference_textbooks=["Book 1", "Book 2"]' \
  -F "pdf_files=@/path/to/Session_1.pdf" \
  -F "pdf_files=@/path/to/Session_2.pdf"
```

**Response**:
```json
{
  "success": true,
  "message": "Successfully ingested 2 lectures",
  "course_id": 1,
  "course_code": "MAPP_F_MKT404_EN_2025",
  "lecture_ids": [1, 2]
}
```

---

### 2. Trigger Pipeline Actions

**POST** `/{action}/{lecture_id}`

Trigger a specific pipeline action for a lecture.

**Actions**: `analyze`, `flashcards`, `quiz`, `index`

#### Example: Run Structured Analysis

```bash
curl -X POST "http://localhost:8000/api/v1/content/analyze/1"
```

**Response**:
```json
{
  "success": true,
  "message": "Structured analysis completed",
  "lecture_id": 1
}
```

#### Example: Generate Flashcards

```bash
curl -X POST "http://localhost:8000/api/v1/content/flashcards/1"
```

#### Example: Generate Quizzes

```bash
curl -X POST "http://localhost:8000/api/v1/content/quiz/1"
```

#### Example: Index to Qdrant

```bash
curl -X POST "http://localhost:8000/api/v1/content/index/1"
```

---

### 3. List All Courses

**GET** `/courses`

```bash
curl "http://localhost:8000/api/v1/content/courses"
```

**Response**:
```json
[
  {
    "id": 1,
    "course_code": "MAPP_F_MKT404_EN_2025",
    "course_name": "Customer experience and branding",
    "instructor": "Professor Jean-Christophe Pineau",
    "additional_info": "Groups 5-11-15",
    "reference_textbooks": ["Book 1", "Book 2"],
    "created_at": "2025-11-24T10:00:00Z",
    "updated_at": "2025-11-24T10:00:00Z"
  }
]
```

---

### 4. List Lectures

**GET** `/lectures?course_code={course_code}`

List all lectures, optionally filtered by course.

```bash
# All lectures
curl "http://localhost:8000/api/v1/content/lectures"

# Lectures for specific course
curl "http://localhost:8000/api/v1/content/lectures?course_code=MAPP_F_MKT404_EN_2025"
```

**Response**:
```json
[
  {
    "id": 1,
    "course_code": "MAPP_F_MKT404_EN_2025",
    "lecture_title": "Session_1.pdf",
    "r2_pdf_path": "docs/course_slides_pdf/MAPP_F_MKT404_EN_2025/Session_1.pdf",
    "analysis_status": "completed",
    "flashcard_status": "completed",
    "quiz_status": "in_progress",
    "qdrant_status": "pending",
    "error_log": null,
    "created_at": "2025-11-24T10:05:00Z",
    "updated_at": "2025-11-24T10:15:00Z"
  }
]
```

---

### 5. Get Lecture Details

**GET** `/lectures/{lecture_id}`

Get detailed information about a specific lecture.

```bash
curl "http://localhost:8000/api/v1/content/lectures/1"
```

**Response**: Same as individual lecture object above.

---

## Status Values

Each lecture has 4 status fields:

| Status Field | Possible Values | Meaning |
|-------------|----------------|---------|
| `analysis_status` | `pending`, `in_progress`, `completed`, `failed` | Structured analysis |
| `flashcard_status` | `pending`, `in_progress`, `completed`, `failed` | Flashcard generation |
| `quiz_status` | `pending`, `in_progress`, `completed`, `failed` | Quiz generation |
| `qdrant_status` | `pending`, `in_progress`, `completed`, `failed` | Vector indexing |

---

## Frontend Button Logic

Based on lecture status, show appropriate action buttons:

```javascript
// Analyze Button: Active if analysis not completed
const showAnalyzeButton = 
  lecture.analysis_status === 'pending' || 
  lecture.analysis_status === 'failed';

// Flashcards Button: Active if analysis completed
const showFlashcardsButton = 
  lecture.analysis_status === 'completed' &&
  (lecture.flashcard_status === 'pending' || 
   lecture.flashcard_status === 'failed');

// Quiz Button: Active if flashcards completed
const showQuizButton = 
  lecture.flashcard_status === 'completed' &&
  (lecture.quiz_status === 'pending' || 
   lecture.quiz_status === 'failed');

// Index Button: Active if flashcards completed
const showIndexButton = 
  lecture.flashcard_status === 'completed' &&
  (lecture.qdrant_status === 'pending' || 
   lecture.qdrant_status === 'failed');
```

---

## Error Handling

If a step fails, check the `error_log` field:

```json
{
  "error_log": {
    "analysis_error": {
      "error": "Connection timeout",
      "traceback": "Full Python traceback...",
      "timestamp": "2025-11-24T10:10:00Z"
    }
  }
}
```

You can retry the failed step by calling the same endpoint again.

---

## Complete Workflow Example

```bash
# 1. Ingest course and lectures
curl -X POST "http://localhost:8000/api/v1/content/ingest" \
  -F "course_code=TEST_COURSE" \
  -F "course_name=Test Course" \
  -F "pdf_files=@lecture1.pdf"

# Returns: {"lecture_ids": [1]}

# 2. Run analysis
curl -X POST "http://localhost:8000/api/v1/content/analyze/1"

# 3. Check status
curl "http://localhost:8000/api/v1/content/lectures/1"

# 4. Generate flashcards (when analysis complete)
curl -X POST "http://localhost:8000/api/v1/content/flashcards/1"

# 5. Generate quizzes (when flashcards complete)
curl -X POST "http://localhost:8000/api/v1/content/quiz/1"

# 6. Index to Qdrant (when flashcards complete)
curl -X POST "http://localhost:8000/api/v1/content/index/1"

# 7. View all lectures with statuses
curl "http://localhost:8000/api/v1/content/lectures?course_code=TEST_COURSE"
```

---

## OpenAPI Documentation

Once the server is running, visit:
- Swagger UI: `http://localhost:8000/docs`
- ReDoc: `http://localhost:8000/redoc`

